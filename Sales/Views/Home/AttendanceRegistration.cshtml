@model AttendanceViewModel
@{
	ViewData["Page"] = "تسجيل حضور الطلاب";
}
<!--begin::Content wrapper-->
<div class="d-flex flex-column flex-column-fluid">
	<!--begin::Toolbar-->
	<div id="kt_app_toolbar" class="app-toolbar pt-7 pt-lg-10">
		<div id="kt_app_toolbar_container" class="app-container container-fluid d-flex align-items-stretch">
			<div class="app-toolbar-wrapper d-flex flex-stack flex-wrap gap-4 w-100">
				<div class="page-title d-flex align-items-center gap-1 me-3">
					<div class="symbol symbol-60px me-3">
						<img src="~/images/school-logo.png" alt="شعار المدرسة" />
					</div>
					<div class="d-flex flex-column justify-content-center">
						<h1 class="page-heading d-flex align-items-center text-dark fw-bold fs-3 m-0">
							<i class="ki-outline ki-calendar-tick fs-1 me-3"></i>
							@ViewData["Page"]
						</h1>
						<ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 pt-1 mb-0">
							<li class="breadcrumb-item text-muted">الرئيسية</li>
							<li class="breadcrumb-item"><span class="bullet bg-gray-400 w-5px h-2px"></span></li>
							<li class="breadcrumb-item text-muted">تسجيل الحضور</li>
						</ul>
					</div>
				</div>
				<div class="d-flex align-items-center gap-2 gap-lg-3">
					<a href="@Url.Action("Index", "Home")" class="btn btn-sm btn-light-primary">
						<i class="ki-outline ki-arrow-right fs-2"></i>
						رجوع
					</a>
				</div>
			</div>
		</div>
	</div>
	<!--end::Toolbar-->
	<!--begin::Content-->
	<div id="kt_app_content" class="app-content flex-column-fluid">
		<div id="kt_app_content_container" class="app-container container-fluid">
			<div class="row g-5 g-xl-10">
				<!--begin::Statistics Cards-->
				<div class="col-xl-12 mb-5">
					<div class="row g-5">
						<div class="col-md-4">
							<div class="card card-flush h-100 bg-light-success">
								<div class="card-body d-flex flex-column justify-content-between">
									<i class="ki-outline ki-check-circle fs-2hx text-success mb-3"></i>
									<div>
										<span class="text-gray-700 fw-bold fs-6 d-block">إجمالي الحضور اليوم</span>
										<span class="text-success fw-bold fs-2x" id="totalAttendance">@Model.Present</span>
									</div>
								</div>
							</div>
						</div>
						<div class="col-md-4">
							<div class="card card-flush h-100 bg-light-warning">
								<div class="card-body d-flex flex-column justify-content-between">
									<i class="ki-outline ki-time fs-2hx text-warning mb-3"></i>
									<div>
										<span class="text-gray-700 fw-bold fs-6 d-block">الوقت الحالي</span>
										<span class="text-warning fw-bold fs-2x" id="currentTime">--:--</span>
									</div>
								</div>
							</div>
						</div>
						<div class="col-md-4">
							<div class="card card-flush h-100 bg-light-info">
								<div class="card-body d-flex flex-column justify-content-between">
									<i class="ki-outline ki-calendar fs-2hx text-info mb-3"></i>
									<div>
										<span class="text-gray-700 fw-bold fs-6 d-block">التاريخ</span>
										<span class="text-info fw-bold fs-6" id="currentDate">--/--/----</span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!--end::Statistics Cards-->
				<!--begin::Main Card-->
				<div class="col-xl-12">
					<div class="card shadow-sm">
						<div class="card-header border-0 pt-6">
							<div class="card-title">
								<div class="d-flex align-items-center">
									<i class="ki-outline ki-tablet-text-down fs-2x text-primary me-3"></i>
									<h3 class="fw-bold m-0">تسجيل الحضور</h3>
								</div>
							</div>
						</div>
						<div class="card-body p-10">
							<div class="row justify-content-center">
								<div class="col-lg-8 col-xl-6">
									<!--begin::Input group-->
									<div class="mb-10">
										<label class="form-label fs-4 fw-bold text-gray-800 mb-5">
											<i class="ki-outline ki-barcode fs-3 me-2"></i>
											أدخل كود الطالبة
										</label>
										<div class="position-relative">
											<input type="text"
												   id="studentCodeInput"
												   class="form-control form-control-lg form-control-solid fs-2 text-center"
												   placeholder="اكتب كود الطالبة"
												   autocomplete="off"
												   autofocus />
											<div class="position-absolute top-50 start-0 translate-middle-y ms-5">
												<i class="ki-outline ki-magnifier fs-2 text-gray-500"></i>
											</div>
										</div>
										<div class="form-text text-center mt-3">
											<i class="ki-outline ki-information-5 fs-6 me-1"></i>
											اضغط Enter بعد إدخال الكود
										</div>
									</div>
									<!--end::Input group-->
									<!--begin::Alert container-->
									<div id="alertContainer"></div>
									<!--end::Alert container-->
									<!--begin::Recent registrations-->
									<div id="recentRegistrations" class="mt-10" style="display: none;">
										<div class="d-flex align-items-center mb-7">
											<i class="ki-outline ki-time fs-2x text-primary me-3"></i>
											<h4 class="fw-bold m-0">آخر التسجيلات</h4>
										</div>
										<div class="table-responsive">
											<table class="table table-row-bordered table-row-gray-100 align-middle gy-4 gs-9">
												<thead>
													<tr class="fw-bold fs-6 text-white border-bottom-2 border-gray-200">
														<th class="min-w-150px">
															<i class="ki-outline ki-profile-user fs-5 me-2"></i>
															اسم الطالب
														</th>
														<th class="min-w-100px">
															<i class="ki-outline ki-time fs-5 me-2"></i>
															الوقت
														</th>
														<th class="min-w-100px text-center">
															<i class="ki-outline ki-check-circle fs-5 me-2"></i>
															الحالة
														</th>
													</tr>
												</thead>
												<tbody id="registrationsList">
												</tbody>
											</table>
										</div>
									</div>
									<!--end::Recent registrations-->
								</div>
							</div>
						</div>
					</div>
				</div>
				<!--end::Main Card-->
			</div>
		</div>
	</div>
	<!--end::Content-->
</div>
<!--end::Content wrapper-->
@section Scripts
{
	<script src="/js/AttendanceRegistration.js"></script>
	<script>
		// Update current time and date
		function updateDateTime() {
			const now = new Date();
			const timeString = now.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
			const dateString = now.toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

			document.getElementById('currentTime').textContent = timeString;
			document.getElementById('currentDate').textContent = dateString;
		}

		// Update time every second
		updateDateTime();
		setInterval(updateDateTime, 6000);

		// Load today's attendance count
	</script>
}