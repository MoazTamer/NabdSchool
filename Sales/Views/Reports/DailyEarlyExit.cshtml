@{
    ViewData["Title"] = "تقرير الخروج المبكر";
    ViewData["Page"] = "تقرير الخروج المبكر";
}

<style>
    label {
        font-size: 1.2rem;
        font-weight: bold;
    }

    tbody {
        font-size: 1.1rem;
        font-weight: 600;
    }

    .excel-btn {
        background-color: #198754 !important;
        color: white !important;
        border: none !important;
        padding: 9px 18px !important;
    }

    .dt-buttons .btn {
        border-radius: 5px !important;
    }

    .form-control.form-control-solid{
        font-size: 1.2rem;
        font-weight : bold;
        color: black;
    }
</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

<!--begin::Content wrapper-->
<div class="d-flex flex-column flex-column-fluid">

    <!--begin::Toolbar-->
    <div id="kt_app_toolbar" class="app-toolbar pt-7 pt-lg-10">
        <div id="kt_app_toolbar_container" class="app-container container-fluid d-flex align-items-stretch">
            <div class="app-toolbar-wrapper d-flex flex-stack flex-wrap gap-4 w-100">

                <!-- عنوان الصفحة -->
                <div class="page-title d-flex align-items-center gap-1 me-3">
                    <div class="symbol symbol-60px me-3">
                        <img src="~/images/school-logo.png" alt="شعار المدرسة" />
                    </div>

                    <div class="d-flex flex-column justify-content-center">
                        <h1 class="page-heading d-flex align-items-center text-dark fw-bold fs-3 m-0">
                            <i class="ki-outline ki-exit-left fs-1 me-3 text-warning"></i>
                            تقرير الخروج المبكر (استئذان)
                        </h1>

                        <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 pt-1 mb-0">
                            <li class="breadcrumb-item text-muted">الرئيسية</li>
                            <li class="breadcrumb-item">
                                <span class="bullet bg-gray-400 w-5px h-2px"></span>
                            </li>
                            <li class="breadcrumb-item text-muted">التقارير</li>
                            <li class="breadcrumb-item">
                                <span class="bullet bg-gray-400 w-5px h-2px"></span>
                            </li>
                            <li class="breadcrumb-item text-muted">الخروج المبكر</li>
                        </ul>
                    </div>
                </div>

                <!-- زر الرجوع -->
                <div class="d-flex align-items-center gap-2 gap-lg-3">
                    <a href="@Url.Action("Index", "Home")" class="btn btn-sm btn-light-primary">
                        <i class="ki-outline ki-arrow-right fs-2"></i>
                        رجوع
                    </a>
                </div>

            </div>
        </div>
    </div>
    <!--end::Toolbar-->
    <!--begin::Content-->
    <div id="kt_app_content" class="app-content flex-column-fluid">
        <div id="kt_app_content_container" class="app-container container-fluid">

            <!--begin::Filter Card-->
            <div class="card shadow-sm mb-5">
                <div class="card-header border-0 pt-6">
                    <div class="card-title">
                        <i class="ki-outline ki-filter fs-2x text-warning me-3"></i>
                        <h3 class="fw-bold m-0">تصفية التقرير</h3>
                    </div>
                </div>

                <div class="card-body pt-0">
                    <div class="row g-5">

                        <!-- التاريخ -->
                        <div class="col-md-3">
                            <label class="form-label fw-bold">التاريخ</label>
                            <input type="date" id="dateFilter" class="form-control form-control-solid"
                                   value="@DateTime.Today.ToString("yyyy-MM-dd")" />
                        </div>

                        <!-- الصف -->
                        <div class="col-md-3">
                            <label class="form-label fw-bold">الصف</label>
                            <select id="classFilter" class="form-select form-select-solid">
                                <option value="">جميع الصفوف</option>
                            </select>
                        </div>

                        <!-- الفصل -->
                        <div class="col-md-3">
                            <label class="form-label fw-bold">الفصل</label>
                            <select id="classRoomFilter" class="form-select form-select-solid" disabled>
                                <option value="">جميع الفصول</option>
                            </select>
                        </div>

                        <!-- زر البحث -->
                        <div class="col-md-3 d-flex align-items-end">
                            <button type="button" id="searchBtn" class="btn btn-warning w-100">
                                <i class="ki-outline ki-magnifier fs-2"></i>
                                عرض التقرير
                            </button>
                        </div>

                    </div>
                </div>
            </div>
            <!--end::Filter Card-->
            <!--begin::Summary Cards-->
            <div class="row g-5 mb-5" id="summaryCards" style="display: none;">
                <div class="col-md-4">
                    <div class="card card-flush bg-light-warning h-100">
                        <div class="card-body">
                            <i class="ki-outline ki-exit-left fs-3hx text-warning mb-3"></i>
                            <div>
                                <span class="text-gray-700 fw-bold fs-6 d-block">إجمالي الطلاب المستأذنين</span>
                                <span class="text-warning fw-bold fs-2x" id="totalEarlyExit">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="card card-flush bg-light-info h-100">
                        <div class="card-body">
                            <i class="ki-outline ki-chart-line-up fs-3hx text-info mb-3"></i>
                            <div>
                                <span class="text-gray-700 fw-bold fs-6 d-block">عدد الفصول المتأثرة</span>
                                <span class="text-info fw-bold fs-2x" id="totalClasses">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="card card-flush bg-light-primary h-100">
                        <div class="card-body">
                            <i class="ki-outline ki-calendar fs-3hx text-primary mb-3"></i>
                            <div>
                                <span class="text-gray-700 fw-bold fs-6 d-block">تاريخ التقرير</span>
                                <span class="text-primary fw-bold fs-4" id="reportDateDisplay">--/--/----</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--end::Summary Cards-->
            <!--begin::Report Container-->
            <div id="reportContainer" style="display: none;">
                <div id="classesContainer"></div>
            </div>
            <!--end::Report Container-->
            <!--begin::Empty State-->
            <div class="card shadow-sm" id="emptyState">
                <div class="card-body text-center py-20">
                    <i class="ki-outline ki-file-deleted fs-5x text-gray-400 mb-5"></i>
                    <h3 class="text-gray-600 fw-bold mb-3">لا توجد بيانات</h3>
                    <p class="text-gray-500">اختر التاريخ والفلاتر ثم اضغط على "عرض التقرير"</p>
                </div>
            </div>
            <!--end::Empty State-->
            <!--begin::Report Table-->
            <div class="card shadow-sm mt-5" id="reportTableCard" style="display: none;">
                <div class="card-header border-0 pt-6">
                    <div class="card-title">
                        <i class="ki-outline ki-table fs-2x text-primary me-3"></i>
                        <h3 class="fw-bold m-0">تفاصيل الطلاب المستأذنين</h3>
                    </div>
                    <div class="card-toolbar">
                        <div id="exportButtonsContainer"></div>
                    </div>
                </div>
                <div class="card-body pt-0">
                    <div class="table-responsive">
                        <table id="earlyExitTable" class="table table-hover table-row-bordered table-row-gray-300 gy-4">
                            <thead class="bg-light-primary">
                                <tr class="fw-bold fs-6 text-gray-800 border-bottom border-gray-200">
                                    <th class="text-center">#</th>
                                    <th>اسم الطالبة</th>
                                    <th class="text-center">كود الطالبة</th>
                                    <th class="text-center">رقم الجوال</th>
                                    <th class="text-center">وقت الخروج</th>
                                    <th class="text-center">الصف</th>
                                    <th class="text-center">الفصل</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملؤها بواسطة DataTable -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!--end::Report Table-->

            <!--begin::Export Buttons-->
            <div class="d-flex justify-content-end gap-3 mt-5" id="exportButtons" style="display: none;">
                <button type="button" id="printBtn" class="btn btn-primary">
                    <i class="ki-outline ki-printer fs-2"></i>
                    طباعة تقرير (PDF)
                </button>

                <button type="button" id="previewBtn" class="btn btn-light-primary">
                    <i class="ki-outline ki-document fs-2"></i>
                    معاينة سريعة
                </button>
            </div>
            <!--end::Export Buttons-->

        </div>
    </div>
    <!--end::Content-->
</div>
<!--end::Content wrapper-->


@section Scripts {
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- DataTables Buttons -->
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>

    <script src="~/js/DailyEarlyExit.js"></script>
}